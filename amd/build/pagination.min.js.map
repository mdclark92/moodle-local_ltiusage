{"version":3,"file":"pagination.min.js","sources":["../src/pagination.js"],"sourcesContent":["/* eslint-disable max-len */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module local_ltiusage/pagination\n * @copyright 2025 Michael Clark <michael.d.clark@glasgow.ac.uk>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n **/\ndefine(['jquery', 'core/ajax'], function($, ajax) {\n    'use strict';\n\n    var init = function() {\n\n        $(document).off('click.pagination').on('click.pagination', '.pagination a', function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            e.stopPropagation();\n\n            var link = $(this);\n\n            // Skip disabled links.\n            if (link.hasClass('disabled') || link.closest('li').hasClass('disabled')) {\n                return false;\n            }\n\n            var url = link.attr('href');\n            var tableContainer = link.closest('.lti-usage-table-group');\n            var pageMatch = url.match(/page_(\\d+)=(\\d+)/);\n            if (!pageMatch) {\n                return false;\n            }\n            var typeId = parseInt(pageMatch[1]);\n            var pageNum = parseInt(pageMatch[2]);\n\n            // Show loading indicator.\n            tableContainer.find('table').css('opacity', '0.5');\n\n            // Call external service.\n            ajax.call([{\n                methodname: 'local_ltiusage_get_pagination',\n                args: {\n                    typeid: typeId,\n                    page: pageNum,\n                    perpage: 25\n                },\n                done: function(response) {\n\n                    // Update table content with new data.\n                    var tbody = tableContainer.find('tbody');\n                    tbody.empty();\n\n                    response.rows.forEach(function(row) {\n                        var deleteCell = response.candelete ?\n                            '<td><a href=\"' + row.deletelink + '\" onclick=\"return confirm(\\'Are you sure you want to delete this LTI activity?\\');\">Delete</a></td>' :\n                            '';\n\n                        var tr = '<tr>' +\n                            '<td>' + row.course + '</td>' +\n                            '<td>' + row.name + '</td>' +\n                            '<td>' + row.visible + '</td>' +\n                            '<td><a href=\"' + row.link + '\">Open</a></td>' +\n                            deleteCell +\n                            '</tr>';\n                        tbody.append(tr);\n                    });\n\n                    // Update pagination if needed - regenerate the entire navigation.\n                    var paginationUl = tableContainer.find('.pagination');\n                    if (paginationUl.length) {\n                        var totalPages = Math.ceil(response.total / 25);\n                        var html = '';\n\n                        // First button.\n                        html += '<li class=\"page-item' + (pageNum === 0 ? ' disabled' : '') + '\">';\n                        html += '<a href=\"' + url.replace(/page_\\d+=\\d+/, 'page_' + typeId + '=0') + '\" class=\"page-link' + (pageNum === 0 ? ' disabled' : '') + '\">&laquo; First</a>';\n                        html += '</li>';\n\n                        // Previous button.\n                        if (response.has_prev) {\n                            html += '<li class=\"page-item\">';\n                            html += '<a href=\"' + url.replace(/page_\\d+=\\d+/, 'page_' + typeId + '=' + response.prev) + '\" class=\"page-link\">&lsaquo; Previous</a>';\n                            html += '</li>';\n                        }\n\n                        // Page info.\n                        html += '<li class=\"page-item disabled\">';\n                        html += '<span class=\"page-link\">Page ' + (pageNum + 1) + ' of ' + totalPages + '</span>';\n                        html += '</li>';\n\n                        // Next button.\n                        if (response.has_next) {\n                            html += '<li class=\"page-item\">';\n                            html += '<a href=\"' + url.replace(/page_\\d+=\\d+/, 'page_' + typeId + '=' + response.next) + '\" class=\"page-link\">Next &rsaquo;</a>';\n                            html += '</li>';\n                        }\n\n                        // Last button.\n                        html += '<li class=\"page-item' + (pageNum === totalPages - 1 ? ' disabled' : '') + '\">';\n                        html += '<a href=\"' + url.replace(/page_\\d+=\\d+/, 'page_' + typeId + '=' + (totalPages - 1)) + '\" class=\"page-link' + (pageNum === totalPages - 1 ? ' disabled' : '') + '\">Last &raquo;</a>';\n                        html += '</li>';\n\n                        paginationUl.html(html);\n                    }\n\n                    // Restore opacity.\n                    tableContainer.find('table').css('opacity', '1');\n\n                    // Scroll to table top.\n                    setTimeout(function() {\n                        $(window).scrollTop(tableContainer.offset().top - 20);\n                    }, 10);\n                },\n            }]);\n\n            return false;\n        });\n    };\n\n    // Make the module globally available for js_init_call\n    M.local_ltiusage = M.local_ltiusage || {};\n    M.local_ltiusage.pagination = {init: init};\n\n    return {init: init};\n});"],"names":["define","$","ajax","init","document","off","on","e","preventDefault","stopImmediatePropagation","stopPropagation","link","this","hasClass","closest","url","attr","tableContainer","pageMatch","match","typeId","parseInt","pageNum","find","css","call","methodname","args","typeid","page","perpage","done","response","tbody","empty","rows","forEach","row","deleteCell","candelete","deletelink","tr","course","name","visible","append","paginationUl","length","totalPages","Math","ceil","total","html","replace","has_prev","prev","has_next","next","setTimeout","window","scrollTop","offset","top","M","local_ltiusage","pagination"],"mappings":";;;;;AAqBAA,OAAM,4BAAC,CAAC,SAAU,aAAc,SAASC,EAAGC,MAGxC,IAAIC,KAAO,WAEPF,EAAEG,UAAUC,IAAI,oBAAoBC,GAAG,mBAAoB,gBAAiB,SAASC,GACjFA,EAAEC,iBACFD,EAAEE,2BACFF,EAAEG,kBAEF,IAAIC,KAAOV,EAAEW,MAGb,GAAID,KAAKE,SAAS,aAAeF,KAAKG,QAAQ,MAAMD,SAAS,YACzD,OAAO,EAGX,IAAIE,IAAMJ,KAAKK,KAAK,QAChBC,eAAiBN,KAAKG,QAAQ,0BAC9BI,UAAYH,IAAII,MAAM,oBAC1B,IAAKD,UACD,OAAO,EAEX,IAAIE,OAASC,SAASH,UAAU,IAC5BI,QAAUD,SAASH,UAAU,IAkFjC,OA/EAD,eAAeM,KAAK,SAASC,IAAI,UAAW,OAG5CtB,KAAKuB,KAAK,CAAC,CACPC,WAAY,gCACZC,KAAM,CACFC,OAAQR,OACRS,KAAMP,QACNQ,QAAS,IAEbC,KAAM,SAASC,UAGX,IAAIC,MAAQhB,eAAeM,KAAK,SAChCU,MAAMC,QAENF,SAASG,KAAKC,QAAQ,SAASC,KAC3B,IAAIC,WAAaN,SAASO,UACtB,gBAAkBF,IAAIG,WAAa,sGACnC,GAEAC,GAAK,WACIJ,IAAIK,OADR,YAEIL,IAAIM,KAFR,YAGIN,IAAIO,QAHR,qBAIaP,IAAI1B,KAAO,kBAC7B2B,WACA,QACJL,MAAMY,OAAOJ,GACjB,GAGA,IAAIK,aAAe7B,eAAeM,KAAK,eACvC,GAAIuB,aAAaC,OAAQ,CACrB,IAAIC,WAAaC,KAAKC,KAAKlB,SAASmB,MAAQ,IACxCC,KAAO,GAGXA,MAAQ,wBAAsC,IAAZ9B,QAAgB,YAAc,IAAM,KACtE8B,MAAQ,YAAcrC,IAAIsC,QAAQ,eAAgB,QAAUjC,OAAS,MAAQ,sBAAoC,IAAZE,QAAgB,YAAc,IAAM,sBACzI8B,MAAQ,QAGJpB,SAASsB,WACTF,MAAQ,yBACRA,MAAQ,YAAcrC,IAAIsC,QAAQ,eAAgB,QAAUjC,OAAS,IAAMY,SAASuB,MAAQ,4CAC5FH,MAAQ,SAIZA,MAAQ,kCACRA,MAAQ,iCAAmC9B,QAAU,GAAK,OAAS0B,WAAa,UAChFI,MAAQ,QAGJpB,SAASwB,WACTJ,MAAQ,yBACRA,MAAQ,YAAcrC,IAAIsC,QAAQ,eAAgB,QAAUjC,OAAS,IAAMY,SAASyB,MAAQ,wCAC5FL,MAAQ,SAIZA,MAAQ,wBAA0B9B,UAAY0B,WAAa,EAAI,YAAc,IAAM,KACnFI,MAAQ,YAAcrC,IAAIsC,QAAQ,eAAgB,QAAUjC,OAAS,KAAO4B,WAAa,IAAM,sBAAwB1B,UAAY0B,WAAa,EAAI,YAAc,IAAM,qBACxKI,MAAQ,QAERN,aAAaM,KAAKA,KACtB,CAGAnC,eAAeM,KAAK,SAASC,IAAI,UAAW,KAG5CkC,WAAW,WACPzD,EAAE0D,QAAQC,UAAU3C,eAAe4C,SAASC,IAAM,GACrD,EAAE,GACP,MAGG,CACX,IAOJ,OAHAC,EAAEC,eAAiBD,EAAEC,gBAAkB,CAAA,EACvCD,EAAEC,eAAeC,WAAa,CAAC9D,KAAMA,MAE9B,CAACA,KAAMA,KAClB"}