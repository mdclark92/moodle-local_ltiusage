{"version":3,"file":"pagination.min.js","sources":["../src/pagination.js"],"sourcesContent":["/* eslint-disable max-len */\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module local_ltiusage/pagination\n * @copyright 2025 Michael Clark <michael.d.clark@glasgow.ac.uk>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n **/\ndefine(['jquery', 'core/ajax'], function($, ajax) {\n    'use strict';\n\n    return {\n        init: function() {\n            $(document).off('click.pagination').on('click.pagination', '.pagination a', function(e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                e.stopPropagation();\n\n                var link = $(this);\n                var url = link.attr('href');\n                var tableContainer = link.closest('.lti-usage-table-group');\n                var pageMatch = url.match(/page_(\\d+)=(\\d+)/);\n                var typeId = parseInt(pageMatch[1]);\n                var pageNum = parseInt(pageMatch[2]);\n\n                // Show loading indicator\n                tableContainer.find('table').css('opacity', '0.5');\n\n                // Call external service\n                ajax.call([{\n                    methodname: 'local_ltiusage_get_pagination',\n                    args: {\n                        typeid: typeId,\n                        page: pageNum,\n                        perpage: 25\n                    },\n                    done: function(response) {\n\n                        // Update table content with new data\n                        var tbody = tableContainer.find('tbody');\n                        tbody.empty();\n\n                        response.rows.forEach(function(row) {\n                            var deleteCell = response.can_delete ?\n                                '<td><a href=\"' + row.deletelink + '\" onclick=\"return confirm(\\'Are you sure you want to delete this LTI activity?\\');\">Delete</a></td>' :\n                                '';\n\n                            var tr = '<tr>' +\n                                '<td>' + row.course + '</td>' +\n                                '<td>' + row.name + '</td>' +\n                                '<td>' + row.visible + '</td>' +\n                                '<td><a href=\"' + row.link + '\">Open</a></td>' +\n                                deleteCell +\n                                '</tr>';\n                            tbody.append(tr);\n                        });\n\n                        // Update pagination if needed\n                        var paginationDiv = tableContainer.find('.pagination');\n                        if (paginationDiv.length) {\n                            // Re-generate pagination HTML based on response\n                            var totalPages = Math.ceil(response.total / 25);\n                            var paginationHtml = '';\n\n                            if (pageNum > 0) {\n                                paginationHtml += '<a href=\"' + url.replace(/page_\\d+=\\d+/, 'page_' + typeId + '=' + (pageNum - 1)) + '\" class=\"btn btn-secondary\">&lsaquo; Previous</a> ';\n                            }\n\n                            paginationHtml += 'Page ' + (pageNum + 1) + ' of ' + totalPages;\n\n                            if (pageNum < totalPages - 1) {\n                                paginationHtml += ' <a href=\"' + url.replace(/page_\\d+=\\d+/, 'page_' + typeId + '=' + (pageNum + 1)) + '\" class=\"btn btn-secondary\">Next &rsaquo;</a>';\n                            }\n\n                            paginationDiv.html(paginationHtml);\n                        }\n\n                        // Restore opacity\n                        tableContainer.find('table').css('opacity', '1');\n\n                        // Scroll to table top\n                        setTimeout(function() {\n                            $(window).scrollTop(tableContainer.offset().top - 20);\n                        }, 10);\n                    },\n\n                }]);\n\n                return false;\n            });\n        }\n    };\n});"],"names":["define","$","ajax","init","document","off","on","e","preventDefault","stopImmediatePropagation","stopPropagation","link","this","url","attr","tableContainer","closest","pageMatch","match","typeId","parseInt","pageNum","find","css","call","methodname","args","typeid","page","perpage","done","response","tbody","empty","rows","forEach","row","deleteCell","can_delete","deletelink","tr","course","name","visible","append","paginationDiv","length","totalPages","Math","ceil","total","paginationHtml","replace","html","setTimeout","window","scrollTop","offset","top"],"mappings":";;;;;AAqBAA,OAAM,4BAAC,CAAC,SAAU,aAAc,SAASC,EAAGC,MAGxC,MAAO,CACHC,KAAM,WACFF,EAAEG,UAAUC,IAAI,oBAAoBC,GAAG,mBAAoB,gBAAiB,SAASC,GACjFA,EAAEC,iBACFD,EAAEE,2BACFF,EAAEG,kBAEF,IAAIC,KAAOV,EAAEW,MACTC,IAAMF,KAAKG,KAAK,QAChBC,eAAiBJ,KAAKK,QAAQ,0BAC9BC,UAAYJ,IAAIK,MAAM,oBACtBC,OAASC,SAASH,UAAU,IAC5BI,QAAUD,SAASH,UAAU,IAiEjC,OA9DAF,eAAeO,KAAK,SAASC,IAAI,UAAW,OAG5CrB,KAAKsB,KAAK,CAAC,CACPC,WAAY,gCACZC,KAAM,CACFC,OAAQR,OACRS,KAAMP,QACNQ,QAAS,IAEbC,KAAM,SAASC,UAGX,IAAIC,MAAQjB,eAAeO,KAAK,SAChCU,MAAMC,QAENF,SAASG,KAAKC,QAAQ,SAASC,KAC3B,IAAIC,WAAaN,SAASO,WACtB,gBAAkBF,IAAIG,WAAa,sGACnC,GAEAC,GAAK,WACIJ,IAAIK,OADR,YAEIL,IAAIM,KAFR,YAGIN,IAAIO,QAHR,qBAIaP,IAAIzB,KAAO,kBAC7B0B,WACA,QACJL,MAAMY,OAAOJ,GACjB,GAGA,IAAIK,cAAgB9B,eAAeO,KAAK,eACxC,GAAIuB,cAAcC,OAAQ,CAEtB,IAAIC,WAAaC,KAAKC,KAAKlB,SAASmB,MAAQ,IACxCC,eAAiB,GAEjB9B,QAAU,IACV8B,gBAAkB,YAActC,IAAIuC,QAAQ,eAAgB,QAAUjC,OAAS,KAAOE,QAAU,IAAM,sDAG1G8B,gBAAkB,SAAW9B,QAAU,GAAK,OAAS0B,WAEjD1B,QAAU0B,WAAa,IACvBI,gBAAkB,aAAetC,IAAIuC,QAAQ,eAAgB,QAAUjC,OAAS,KAAOE,QAAU,IAAM,iDAG3GwB,cAAcQ,KAAKF,eACvB,CAGApC,eAAeO,KAAK,SAASC,IAAI,UAAW,KAG5C+B,WAAW,WACPrD,EAAEsD,QAAQC,UAAUzC,eAAe0C,SAASC,IAAM,GACrD,EAAE,GACP,MAIG,CACX,EACJ,EAER"}